openapi: 3.0.3
info:
  title: Sports Management System API
  version: 1.0.0
  description: |
    REST API for sports management system with content negotiation via Accept headers.
    
    ## Design Principles
    
    ### Content Negotiation
    Uses Accept headers to control resource representations:
    - `application/json` - Base normalized representation (default)
    - `application/vnd.api.{resource}.list+json` - List representation with denormalized data (for tables)
    - `application/vnd.api.{resource}.lookup+json` - Lookup representation (id + name for dropdowns)
    - `application/vnd.api.{resource}.detail+json` - Enriched with denormalized relations
    
    ### Schema Naming Conventions
    Follows industry-standard DTO naming patterns:
    - **{Resource}** - Base normalized response (GET with application/json)
    - **{Resource}ListItem** - List response with denormalized data (GET with list Accept)
    - **{Resource}Lookup** - Lookup response for dropdowns (GET with lookup Accept)
    - **{Resource}Detail** - Enriched response with denormalized relations (GET with detail Accept)
    - **{Resource}Create** - Request model for resource creation (POST)
    - **{Resource}Update** - Request model for full replacement (PUT)
    - **{Resource}Patch** - Request model for partial update (PATCH)
    
    ### Sorting Strategy
    **Flexible multi-field sorting with JSON:API format:**
    - Use `sort` query parameter with comma-separated fields
    - Prefix field with `-` for descending order
    - Examples: `sort=name`, `sort=-createdAt`, `sort=name,-createdAt`
    - Default: `-createdAt` (newest first)
    - Benefits: Multiple fields, clear syntax, industry standard (JSON:API, GitHub API)

    ### HTTP Method Semantics
    - **GET** - Retrieve (idempotent, safe)
    - **POST** - Create (non-idempotent, returns 201 + Location header)
    - **PUT** - Full replacement (idempotent, requires all fields)
    - **PATCH** - Partial update (non-idempotent, optional fields)
    - **DELETE** - Remove (idempotent, returns 204)

  contact:
    name: API Support
    email: api@example.com

servers:
  - url: https://api.example.com/v1
    description: Production server
  - url: https://api-staging.example.com/v1
    description: Staging server

tags:
  - name: Runners
    description: Operations related to runner management
  - name: Coaches
    description: Operations related to coach management

paths:
  /runners:
    get:
      tags:
        - Runners
      summary: List all runners
      description: |
        Retrieve a paginated list of runners with optional filtering and sorting.
        Use Accept header to control the representation of each runner in the list.
      operationId: listRunners
      parameters:
        - name: page
          in: query
          description: Page number (1-indexed)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of items per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: coachId
          in: query
          description: Filter runners by coach ID
          schema:
            type: string
            format: uuid
        - name: search
          in: query
          description: Search in name, email, phone fields
          schema:
            type: string
            minLength: 2
        - name: sort
          in: query
          description: |
            Comma-separated list of fields to sort by.
            Prefix field with `-` for descending order.
            Examples:
            - `name` - sort by name ascending
            - `-createdAt` - sort by createdAt descending (newest first)
            - `name,-createdAt` - sort by name ascending, then createdAt descending
          schema:
            type: string
            pattern: '^-?[a-zA-Z][a-zA-Z0-9]*(,-?[a-zA-Z][a-zA-Z0-9]*)*$'
            example: "name,-createdAt"
            default: "-createdAt"
        - name: Accept
          in: header
          description: |
            Media type for response representation:
            - `application/json` - Base normalized representation (default)
            - `application/vnd.api.runner.list+json` - List with denormalized data (includes coachName)
            - `application/vnd.api.runner.lookup+json` - Lookup (id + name only)
          required: false
          schema:
            type: string
            enum:
              - application/json
              - application/vnd.api.runner.list+json
              - application/vnd.api.runner.lookup+json
            default: application/json
      responses:
        '200':
          description: Successful response with runners list
          content:
            # Base representation (default)
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Runner'
              examples:
                base:
                  summary: Base normalized representation
                  value:
                    - id: "550e8400-e29b-41d4-a716-446655440000"
                      coachId: "660e8400-e29b-41d4-a716-446655440001"
                      name: "John Doe"
                      email: "john.doe@example.com"
                      phone: "+12025551234"
                      languageId: "770e8400-e29b-41d4-a716-446655440002"
                    - id: "550e8400-e29b-41d4-a716-446655440002"
                      coachId: "660e8400-e29b-41d4-a716-446655440001"
                      name: "Jane Smith"
                      email: "jane.smith@example.com"
                      phone: null
                      languageId: "770e8400-e29b-41d4-a716-446655440002"
            
            # List representation (denormalized for tables)
            application/vnd.api.runner.list+json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RunnerListItem'
              examples:
                list:
                  summary: List representation with denormalized data
                  value:
                    - id: "550e8400-e29b-41d4-a716-446655440000"
                      name: "John Doe"
                      email: "john.doe@example.com"
                      phone: "+12025551234"
                      coachId: "660e8400-e29b-41d4-a716-446655440001"
                      coachName: "Coach Smith"
                    - id: "550e8400-e29b-41d4-a716-446655440002"
                      name: "Jane Smith"
                      email: "jane.smith@example.com"
                      phone: "+12025551235"
                      coachId: "660e8400-e29b-41d4-a716-446655440001"
                      coachName: "Coach Smith"
            
            # Lookup representation (for dropdowns)
            application/vnd.api.runner.lookup+json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RunnerLookup'
              examples:
                lookup:
                  summary: Lookup representation (id + name)
                  value:
                    - id: "550e8400-e29b-41d4-a716-446655440000"
                      name: "John Doe"
                    - id: "550e8400-e29b-41d4-a716-446655440002"
                      name: "Jane Smith"
        
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '406':
          $ref: '#/components/responses/NotAcceptable'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []

    post:
      tags:
        - Runners
      summary: Create a new runner
      description: |
        Create a new runner profile. The server will generate `id`.
        Request body uses RunnerCreate schema (without readonly fields).
      operationId: createRunner
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RunnerCreate'
            examples:
              minimal:
                summary: Minimal required fields (phone optional)
                value:
                  coachId: "660e8400-e29b-41d4-a716-446655440001"
                  name: "Jane Smith"
                  email: "jane.smith@example.com"
                  languageId: "770e8400-e29b-41d4-a716-446655440002"
              full:
                summary: All fields provided
                value:
                  coachId: "660e8400-e29b-41d4-a716-446655440001"
                  name: "Jane Smith"
                  email: "jane.smith@example.com"
                  phone: "+12025551235"
                  languageId: "770e8400-e29b-41d4-a716-446655440002"
      responses:
        '201':
          description: Runner created successfully
          headers:
            Location:
              description: URL of the created runner resource
              schema:
                type: string
                format: uri
                example: "/v1/runners/550e8400-e29b-41d4-a716-446655440002"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Runner'
              example:
                id: "550e8400-e29b-41d4-a716-446655440002"
                coachId: "660e8400-e29b-41d4-a716-446655440001"
                name: "Jane Smith"
                email: "jane.smith@example.com"
                phone: "+1234567891"
                languageId: "770e8400-e29b-41d4-a716-446655440002"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []

  /runners/{runnerId}:
    parameters:
      - name: runnerId
        in: path
        required: true
        description: Unique identifier of the runner
        schema:
          type: string
          format: uuid

    get:
      tags:
        - Runners
      summary: Get runner by ID
      description: |
        Retrieve information about a specific runner.
        Use Accept header to control the representation:
        
        - **base** (application/json, default): Complete data including coachId
        - **detail**: Extended data without readonly fields
        
        Useful for different UI contexts:
        - **base**: Admin panels, auditing, debugging, data export
        - **detail**: Profile cards, forms, user-facing displays
      operationId: getRunnerById
      parameters:
        - name: Accept
          in: header
          description: |
            Media type for response representation:
            - `application/json` - Base normalized representation (default)
            - `application/vnd.api.runner.detail+json` - Enriched with denormalized relations
          required: false
          schema:
            type: string
            enum:
              - application/json
              - application/vnd.api.runner.detail+json
            default: application/json
          examples:
            base:
              summary: Request base representation
              value: application/json
            detail:
              summary: Request detail representation
              value: application/vnd.api.runner.detail+json
      
      responses:
        '200':
          description: Runner found
          content:
            # Base representation (default)
            application/json:
              schema:
                $ref: '#/components/schemas/Runner'
              examples:
                base:
                  summary: Base normalized runner data
                  value:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    coachId: "660e8400-e29b-41d4-a716-446655440001"
                    name: "John Doe"
                    email: "john.doe@example.com"
                    phone: "+1234567890"
                    languageId: "770e8400-e29b-41d4-a716-446655440002"

            # Detail representation
            application/vnd.api.runner.detail+json:
              schema:
                $ref: '#/components/schemas/RunnerDetail'
              examples:
                detail:
                  summary: Extended with denormalized related data
                  value:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    name: "John Doe"
                    email: "john.doe@example.com"
                    phone: "+1234567890"
                    coachId: "660e8400-e29b-41d4-a716-446655440001"
                    coachName: "Coach Smith"
                    languageId: "770e8400-e29b-41d4-a716-446655440002"
                    languageName: "English"
            
        
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '406':
          $ref: '#/components/responses/NotAcceptable'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []

    put:
      tags:
        - Runners
      summary: Update runner (full replacement)
      description: |
        Replace all runner data. Requires ALL fields (except readonly).
        Uses RunnerUpdate schema - all fields are required.
        Missing fields will result in validation error.
        
        **Note**: This is idempotent - same request produces same result.
      operationId: updateRunnerFull
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RunnerUpdate'
            examples:
              complete:
                summary: Complete update with all fields
                value:
                  coachId: "660e8400-e29b-41d4-a716-446655440001"
                  name: "John Doe Updated"
                  email: "new.email@example.com"
                  phone: null
                  languageId: "770e8400-e29b-41d4-a716-446655440002"
      responses:
        '200':
          description: Runner updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Runner'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []

    patch:
      tags:
        - Runners
      summary: Partially update runner
      description: |
        Update specific fields of an runner. Only provided fields will be updated.
        Uses RunnerPatch schema - all fields are optional, but at least one is required.
        
        **Note**: This is NOT idempotent if concurrent updates occur.
      operationId: updateRunnerPartial
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RunnerPatch'
            examples:
              updatePhone:
                summary: Update only phone
                value:
                  phone: "+12025559999"
              updateMultiple:
                summary: Update multiple fields
                value:
                  email: "newemail@example.com"
                  languageId: "770e8400-e29b-41d4-a716-446655440003"
              removePhone:
                summary: Remove phone (set to null)
                value:
                  phone: null
      responses:
        '200':
          description: Runner updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Runner'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []

    delete:
      tags:
        - Runners
      summary: Delete runner
      description: |
        Permanently delete an runner profile.

        **Authorization**: Requires `admin` role in JWT token.
        - User with `role: "user"` will receive 403 Forbidden
        - User with `role: "admin"` will succeed with 204 No Content

        Returns 409 Conflict if runner has dependencies (e.g., active training sessions).

        **Note**: This is idempotent - deleting same runner twice returns 404 second time.
      operationId: deleteRunner
      responses:
        '204':
          description: Runner deleted successfully (no content)
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Cannot delete (has dependencies)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "Cannot delete runner with active training sessions"
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []

  /coaches/{coachId}/runners:
    get:
      tags:
        - Runners
      summary: Get runners by coach
      description: |
        Retrieve all runners for a specific coach with pagination.
        Supports same Accept header variations as /runners endpoint.
      operationId: getRunnersByCoach
      parameters:
        - name: coachId
          in: path
          required: true
          description: Unique identifier of the coach
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: Accept
          in: header
          description: Media type for response representation
          required: false
          schema:
            type: string
            enum:
              - application/json
              - application/vnd.api.runner.list+json
              - application/vnd.api.runner.lookup+json
            default: application/json
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Runner'
            application/vnd.api.runner.list+json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RunnerListItem'
            application/vnd.api.runner.lookup+json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RunnerLookup'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '406':
          $ref: '#/components/responses/NotAcceptable'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []

components:
  schemas:
    # ==========================================
    # RESPONSE MODELS (what server returns)
    # ==========================================
    
    Runner:
      type: object
      description: |
        **Base normalized representation** of an runner (default).
        Includes all fields: mutable data + readonly metadata.
        Used with: `application/json`

        Use cases:
        - Default standard representation
        - Admin panels
        - Debugging and auditing
        - Data export
        - When no specific Accept header is provided
      required:
        - id
        - coachId
        - name
        - email
        - phone
        - languageId
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier (generated by server)
          readOnly: true
          example: "550e8400-e29b-41d4-a716-446655440000"
        coachId:
          type: string
          format: uuid
          description: Reference to the coach (User)
          example: "660e8400-e29b-41d4-a716-446655440001"
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Full name of the runner
          example: "John Doe"
        email:
          type: string
          format: email
          maxLength: 255
          description: Email address (must be unique)
          example: "john.doe@example.com"
        phone:
          type: string
          nullable: true
          pattern: '^\+[1-9]\d{7,14}$'
          description: Phone number in E.164 format (optional, minimum 8 digits including country code)
          example: "+12025551234"
        languageId:
          type: string
          format: uuid
          description: Reference to the language
          example: "770e8400-e29b-41d4-a716-446655440002"

    RunnerListItem:
      type: object
      description: |
        **List representation** with denormalized data for tables.
        Used with: `application/vnd.api.runner.list+json`
        
        Use cases:
        - Lists in tables (grid/table views)
        - Denormalized data for performance
        - When related data is needed without client-side JOIN
        - List endpoints with pagination
      required:
        - id
        - name
        - email
        - phone
        - coachId
        - coachName
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          description: Full name of the runner
          example: "John Doe"
        email:
          type: string
          format: email
          description: Email address
          example: "john.doe@example.com"
        phone:
          type: string
          pattern: '^\+[1-9]\d{7,14}$'
          description: Phone number in E.164 format (minimum 8 digits including country code)
          example: "+12025551234"
        coachId:
          type: string
          format: uuid
          description: Coach UUID
          example: "660e8400-e29b-41d4-a716-446655440001"
        coachName:
          type: string
          description: Coach name (denormalized!)
          example: "Coach Smith"

    RunnerLookup:
      type: object
      description: |
        **Lookup representation** for dropdown/select controls.
        Used with: `application/vnd.api.runner.lookup+json`
        
        Use cases:
        - Dropdown lists (select boxes)
        - Autocomplete fields
        - Reference fields in forms
        - Minimal data volume for selection
      required:
        - id
        - name
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          description: Display name
          example: "John Doe"

    RunnerDetail:
      type: object
      description: |
        **Enriched representation** with denormalized related data.
        Contains all base entity fields plus denormalized names from referenced entities.
        Used with: `application/vnd.api.runner.detail+json`

        Use cases:
        - Profile cards and detail views
        - Edit forms with related entity names pre-loaded
        - Rich UI displays without additional API calls
        - Combines base entity with denormalized related data (coach, language names)
      required:
        - id
        - name
        - email
        - phone
        - coachId
        - coachName
        - languageId
        - languageName
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Full name of the runner
          example: "John Doe"
        email:
          type: string
          format: email
          maxLength: 255
          description: Email address
          example: "john.doe@example.com"
        phone:
          type: string
          nullable: true
          pattern: '^\+[1-9]\d{7,14}$'
          description: Phone number in E.164 format (optional, minimum 8 digits including country code)
          example: "+12025551234"
        coachId:
          type: string
          format: uuid
          description: Coach UUID
          example: "660e8400-e29b-41d4-a716-446655440001"
        coachName:
          type: string
          description: Coach name (denormalized!)
          example: "Coach Smith"
        languageId:
          type: string
          format: uuid
          description: Language UUID
          example: "770e8400-e29b-41d4-a716-446655440002"
        languageName:
          type: string
          description: Language name (denormalized!)
          example: "English"


    # ==========================================
    # REQUEST MODELS (what client sends)
    # ==========================================

    RunnerCreate:
      type: object
      description: |
        **Request schema for creating a new runner** (POST /runners).

        Excludes readonly fields:
        - id (generated by server)

        Phone is optional, all other fields are required.
        Server will generate missing fields and return full Runner object.
      required:
        - coachId
        - name
        - email
        - languageId
      properties:
        coachId:
          type: string
          format: uuid
          description: ID of the coach managing this runner
          example: "660e8400-e29b-41d4-a716-446655440001"
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Full name of the runner
          example: "Jane Smith"
        email:
          type: string
          format: email
          maxLength: 255
          description: Email address (must be unique in system)
          example: "jane.smith@example.com"
        phone:
          type: string
          nullable: true
          pattern: '^\+[1-9]\d{7,14}$'
          description: Phone number in E.164 format (optional, minimum 8 digits including country code)
          example: "+12025551235"
        languageId:
          type: string
          format: uuid
          description: ID of the runner's language
          example: "770e8400-e29b-41d4-a716-446655440002"

    RunnerUpdate:
      type: object
      description: |
        **Request schema for full replacement** (PUT /runners/{id}).

        All fields are REQUIRED (including phone which must be explicitly specified, even if null).
        This replaces the entire resource - missing fields will cause validation error.

        Excludes readonly fields:
        - id (cannot be changed)

        Use PATCH for partial updates instead if you don't want to send all fields.
      required:
        - coachId
        - name
        - email
        - phone
        - languageId
      properties:
        coachId:
          type: string
          format: uuid
          description: ID of the coach managing this runner
          example: "660e8400-e29b-41d4-a716-446655440001"
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Full name of the runner
          example: "John Doe"
        email:
          type: string
          format: email
          maxLength: 255
          description: Email address
          example: "john.doe@example.com"
        phone:
          type: string
          nullable: true
          pattern: '^\+?[1-9]\d{1,14}$'
          description: Phone number in E.164 format (can be null)
          example: "+1234567890"
        languageId:
          type: string
          format: uuid
          description: ID of the runner's language
          example: "770e8400-e29b-41d4-a716-446655440002"

    RunnerPatch:
      type: object
      description: |
        **Request schema for partial update** (PATCH /runners/{id}).

        All fields are OPTIONAL - send only what you want to change.
        At least ONE field must be provided.

        Excludes readonly fields:
        - id (cannot be changed)

        Perfect for updating individual fields without touching the rest.
      minProperties: 1
      properties:
        coachId:
          type: string
          format: uuid
          description: ID of the coach managing this runner
          example: "660e8400-e29b-41d4-a716-446655440001"
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Full name of the runner
          example: "John Doe"
        email:
          type: string
          format: email
          maxLength: 255
          description: Email address
          example: "john.doe@example.com"
        phone:
          type: string
          nullable: true
          pattern: '^\+[1-9]\d{7,14}$'
          description: Phone number in E.164 format (set to null to remove, minimum 8 digits including country code)
          example: "+12025551234"
        languageId:
          type: string
          format: uuid
          description: ID of the runner's language
          example: "770e8400-e29b-41d4-a716-446655440002"

    # ==========================================
    # UTILITY SCHEMAS
    # ==========================================

    Error:
      type: object
      description: |
        Simple error response format.
        HTTP status code provides error categorization, message provides details.
      required:
        - message
      properties:
        message:
          type: string
          description: Human-readable error message with details
          example: "Request validation failed"


  # ==========================================
  # REUSABLE RESPONSES
  # ==========================================

  responses:
    BadRequest:
      description: Bad request - invalid parameters or malformed JSON
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: "Invalid request parameters"

    Unauthorized:
      description: Unauthorized - missing or invalid authentication token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: "Authentication required"

    Forbidden:
      description: Forbidden - valid token but insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: "Insufficient permissions. Admin role required."

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: "Runner not found"

    NotAcceptable:
      description: Not Acceptable - unsupported Accept header media type
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: "Unsupported media type in Accept header"

    Conflict:
      description: Conflict - resource already exists or cannot be modified
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: "Email already exists"

    UnprocessableEntity:
      description: Unprocessable Entity - validation failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: "Request validation failed"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: "An unexpected error occurred"

  # ==========================================
  # SECURITY SCHEMES
  # ==========================================

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT Bearer token authentication with role-based access control (RBAC).

        **Include the token in the Authorization header:**
        ```
        Authorization: Bearer <your-jwt-token>
        ```

        **JWT Payload Structure:**
        ```json
        {
          "sub": "user-uuid",
          "email": "user@example.com",
          "role": "user",
          "iat": 1609459200,
          "exp": 1609545600
        }
        ```

        **Roles:**
        - `user` - Regular user with standard permissions
        - `admin` - Administrator with full permissions

        **Role-Based Permissions:**
        - All endpoints require authentication
        - GET, POST, PUT, PATCH operations: accessible to both `user` and `admin`
        - DELETE operations: require `admin` role only
          - User with `role: "user"` → 403 Forbidden
          - User with `role: "admin"` → 204 No Content (success)

        **Error Responses:**
        - Missing/invalid token → 401 Unauthorized
        - Valid token but insufficient permissions → 403 Forbidden

